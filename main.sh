#!/usr/bin/env bash

# ./main.sh uN6hZxnLV5Z8gjC2bpQb8C_EMlo_w1YUt0lSwWsaPzU git@github.com:amitaibu/gizra-behat.git master new-one Ww0KICAgICAgICB7DQogICAgICAgICAgICAiaWQiOiA3NiwNCiAgICAgICAgICAgICJiYXNlbGluZV9uYW1lIjogIndlYmRyaXZlcmNzcy9jaHJvbWUuYW1pdGFpYnUtaG9tZXBhZ2UuYmFzZWxpbmUucG5nIiwNCiAgICAgICAgICAgICJyZWdyZXNzaW9uIjogew0KICAgICAgICAgICAgICAgICJpZCI6ICIxNzgiLA0KICAgICAgICAgICAgICAgICJzZWxmIjogImh0dHA6Ly9sb2NhbGhvc3QvYm9vbS93d3cvc3lzdGVtL2ZpbGVzL2Nocm9tZS5hbWl0YWlidS1ob21lcGFnZS5yZWdyZXNzaW9uXzEwLnBuZyIsDQogICAgICAgICAgICAgICAgImZpbGVtaW1lIjogImltYWdlL3BuZyIsDQogICAgICAgICAgICAgICAgImZpbGVzaXplIjogIjE3NzE5IiwNCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiMTAyNCIsDQogICAgICAgICAgICAgICAgImhlaWdodCI6ICIyNzMiLA0KICAgICAgICAgICAgICAgICJzdHlsZXMiOiB7DQogICAgICAgICAgICAgICAgICAgICJ0aHVtYm5haWwiOiAiaHR0cDovL2xvY2FsaG9zdC9ib29tL3d3dy9zeXN0ZW0vZmlsZXMvc3R5bGVzL3RodW1ibmFpbC9wcml2YXRlL2Nocm9tZS5hbWl0YWlidS1ob21lcGFnZS5yZWdyZXNzaW9uXzEwLnBuZz9pdG9rPWJSbEZYUVVmIiwNCiAgICAgICAgICAgICAgICAgICAgIm1lZGl1bSI6ICJodHRwOi8vbG9jYWxob3N0L2Jvb20vd3d3L3N5c3RlbS9maWxlcy9zdHlsZXMvbWVkaXVtL3ByaXZhdGUvY2hyb21lLmFtaXRhaWJ1LWhvbWVwYWdlLnJlZ3Jlc3Npb25fMTAucG5nP2l0b2s9ZGdsWEFpY28iLA0KICAgICAgICAgICAgICAgICAgICAibGFyZ2UiOiAiaHR0cDovL2xvY2FsaG9zdC9ib29tL3d3dy9zeXN0ZW0vZmlsZXMvc3R5bGVzL2xhcmdlL3ByaXZhdGUvY2hyb21lLmFtaXRhaWJ1LWhvbWVwYWdlLnJlZ3Jlc3Npb25fMTAucG5nP2l0b2s9X2lhRnR5ZFQiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgICAiaWQiOiA3NSwNCiAgICAgICAgICAgICJiYXNlbGluZV9uYW1lIjogIndlYmRyaXZlcmNzcy9jaHJvbWUuZ29vZ2xlLWhvbWVwYWdlLmJhc2VsaW5lLnBuZyIsDQogICAgICAgICAgICAicmVncmVzc2lvbiI6IHsNCiAgICAgICAgICAgICAgICAiaWQiOiAiMTc1IiwNCiAgICAgICAgICAgICAgICAic2VsZiI6ICJodHRwOi8vbG9jYWxob3N0L2Jvb20vd3d3L3N5c3RlbS9maWxlcy9jaHJvbWUuZ29vZ2xlLWhvbWVwYWdlLnJlZ3Jlc3Npb25fMjEucG5nIiwNCiAgICAgICAgICAgICAgICAiZmlsZW1pbWUiOiAiaW1hZ2UvcG5nIiwNCiAgICAgICAgICAgICAgICAiZmlsZXNpemUiOiAiMzYzOTkiLA0KICAgICAgICAgICAgICAgICJ3aWR0aCI6ICIxMDI0IiwNCiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogIjQxOCIsDQogICAgICAgICAgICAgICAgInN0eWxlcyI6IHsNCiAgICAgICAgICAgICAgICAgICAgInRodW1ibmFpbCI6ICJodHRwOi8vbG9jYWxob3N0L2Jvb20vd3d3L3N5c3RlbS9maWxlcy9zdHlsZXMvdGh1bWJuYWlsL3ByaXZhdGUvY2hyb21lLmdvb2dsZS1ob21lcGFnZS5yZWdyZXNzaW9uXzIxLnBuZz9pdG9rPVZZRnRuZHFGIiwNCiAgICAgICAgICAgICAgICAgICAgIm1lZGl1bSI6ICJodHRwOi8vbG9jYWxob3N0L2Jvb20vd3d3L3N5c3RlbS9maWxlcy9zdHlsZXMvbWVkaXVtL3ByaXZhdGUvY2hyb21lLmdvb2dsZS1ob21lcGFnZS5yZWdyZXNzaW9uXzIxLnBuZz9pdG9rPUtodUl5aUFLIiwNCiAgICAgICAgICAgICAgICAgICAgImxhcmdlIjogImh0dHA6Ly9sb2NhbGhvc3QvYm9vbS93d3cvc3lzdGVtL2ZpbGVzL3N0eWxlcy9sYXJnZS9wcml2YXRlL2Nocm9tZS5nb29nbGUtaG9tZXBhZ2UucmVncmVzc2lvbl8yMS5wbmc/aXRvaz1oNWNTVnVMSiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICBd

TOKEN=$1
REPO=$2
BRANCH=$3
NEW_BRANCH=$4
JSON=$5
SSH_KEY=$6

# Create an SSH key.
touch ~/.ssh/id_rsa
echo $SSH_KEY | base64 --decode > ~/.ssh/id_rsa
chmod 600 ~/.ssh/id_rsa

# Clone repo
cd ~
mkdir clone

cd clone
git clone --branch=$BRANCH --depth=1 --quiet $REPO .
git checkout -b $NEW_BRANCH

# Download images
node ../download_images.js $TOKEN $JSON

# Push new branch
git add .
git commit -am "New files"
git push --set-upstream origin $NEW_BRANCH
